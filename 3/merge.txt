MERGE INTO DIM_OBJ_TAB_PROFESSOR
USING DIM_PROFESSOR
ON (DIM_OBJ_TAB_PROFESSOR.ID_PROFESSOR = DIM_PROFESSOR.ID_PROFESSOR)
WHEN MATCHED THEN
UPDATE SET DIM_OBJ_TAB_PROFESSOR.NOME = DIM_PROFESSOR.NOME
WHEN NOT MATCHED THEN 
INSERT (DIM_OBJ_TAB_PROFESSOR.ID_PROFESSOR, DIM_OBJ_TAB_PROFESSOR.NOME)
VALUES (DIM_PROFESSOR.ID_PROFESSOR, DIM_PROFESSOR.NOME);

MERGE INTO DIM_OBJ_TAB_DISCIPLINA
USING DIM_DISCIPLINA
ON (DIM_OBJ_TAB_DISCIPLINA.ID_DISCIPLINA = DIM_DISCIPLINA.ID_DISCIPLINA)
WHEN MATCHED THEN
UPDATE SET DIM_OBJ_TAB_DISCIPLINA.NOME = DIM_DISCIPLINA.NOME, DIM_OBJ_TAB_DISCIPLINA.SIGLA = DIM_DISCIPLINA.SIGLA, DIM_OBJ_TAB_DISCIPLINA.AREA = DIM_DISCIPLINA.AREA, DIM_OBJ_TAB_DISCIPLINA.CARGA = DIM_DISCIPLINA.CARGA, DIM_OBJ_TAB_DISCIPLINA.CREDITOS = DIM_DISCIPLINA.CREDITOS
WHEN NOT MATCHED THEN 
INSERT (DIM_OBJ_TAB_DISCIPLINA.ID_DISCIPLINA, DIM_OBJ_TAB_DISCIPLINA.NOME, DIM_OBJ_TAB_DISCIPLINA.SIGLA, DIM_OBJ_TAB_DISCIPLINA.AREA, DIM_OBJ_TAB_DISCIPLINA.CARGA, DIM_OBJ_TAB_DISCIPLINA.CREDITOS)
VALUES (DIM_DISCIPLINA.ID_DISCIPLINA, DIM_DISCIPLINA.NOME, DIM_DISCIPLINA.SIGLA, DIM_DISCIPLINA.AREA, DIM_DISCIPLINA.CARGA, DIM_DISCIPLINA.CREDITOS);

MERGE INTO DIM_OBJ_TAB_CURSO
USING DIM_CURSO
ON (DIM_OBJ_TAB_CURSO.ID_CURSO = DIM_CURSO.ID_CURSO)
WHEN MATCHED THEN
UPDATE SET DIM_OBJ_TAB_CURSO.NOME = DIM_CURSO.NOME
WHEN NOT MATCHED THEN 
INSERT (DIM_OBJ_TAB_CURSO.ID_CURSO, DIM_OBJ_TAB_CURSO.NOME)
VALUES (DIM_CURSO.ID_CURSO, DIM_CURSO.NOME);

MERGE INTO DIM_OBJ_TAB_SALA
USING DIM_SALA
ON (DIM_OBJ_TAB_SALA.ID_SALA = DIM_SALA.ID_SALA)
WHEN MATCHED THEN
UPDATE SET DIM_OBJ_TAB_SALA.CODIGO = DIM_SALA.CODIGO, DIM_OBJ_TAB_SALA.CAPACIDADE = DIM_SALA.CAPACIDADE
WHEN NOT MATCHED THEN 
INSERT (DIM_OBJ_TAB_SALA.ID_SALA, DIM_OBJ_TAB_SALA.CODIGO, DIM_OBJ_TAB_SALA.CAPACIDADE)
VALUES (DIM_SALA.ID_SALA, DIM_SALA.CODIGO, DIM_SALA.CAPACIDADE);

DECLARE
CURSOR c IS SELECT * FROM FAT_ALOCACAO;
rec_aloc FAT_ALOCACAO%ROWTYPE;
BEGIN
  OPEN c;
  LOOP
    FETCH c INTO rec_aloc;
    EXIT WHEN c%NOTFOUND;
    INSERT INTO FAT_OBJ_TAB_ALOCACAO VALUES ((SELECT REF(d) FROM DIM_OBJ_TAB_DISCIPLINA d WHERE d.ID_DISCIPLINA = rec_aloc.ID_DISCIPLINA),(SELECT REF(p) FROM DIM_OBJ_TAB_PROFESSOR p WHERE p.ID_PROFESSOR = rec_aloc.ID_PROFESSOR), (SELECT REF(c) FROM DIM_OBJ_TAB_CURSO c WHERE c.ID_CURSO = rec_aloc.ID_CURSO), rec_aloc.COD_TURMA, (SELECT REF(s) FROM DIM_OBJ_TAB_SALA s WHERE s.ID_SALA = rec_aloc.ID_SALA), rec_aloc.PERIODO, rec_aloc.QTDE_ALUNOS, rec_aloc.MEDIA_TURMA);
  END LOOP;
  CLOSE c;
END;
/
